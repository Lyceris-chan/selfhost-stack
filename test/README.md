## Verification Suite

This directory contains the comprehensive, unified verification suite for the Privacy Hub.

### Automated Testing Setup

The testing suite automatically loads configuration from the `.env` file generated by the deployment process or can be overridden via `test_config.env`.

1. Ensure you have `bun` or `node` installed for the Puppeteer tests.
2. The verification suite uses `test_runner.py` as the primary entry point.

### Running the Unified Suite

The `test_runner.py` script is the primary entry point. It performs a single-stage full stack verification:

```bash
# Run the full stack verification
python3 test_runner.py --full
```

#### What it does:
1. **Environment Preparation**: Cleans up previous test containers and volumes.
2. **Unified Deployment**: Uses `./zima.sh -G` to generate a full stack configuration and then launches all 18+ services simultaneously.
3. **Connectivity Audit**: Performs rapid HTTP status checks on core infrastructure (Dashboard, Hub API, AdGuard, WireGuard).
4. **Unified Puppeteer Verification**:
   - Launches a headless browser to interact with the Dashboard.
   - Audits console logs for 401/502 errors.
   - Iterates through **every** service to verify UI elements (selectors) and specific content strings.
   - **Full-Spectrum Screenshots**: Captures a full-page screenshot for every service, saved to `test/screenshots/`.
5. **Log Integrity**: Verifies that `deployment.log` contains valid JSON events.

### Screenshot & Log Results

After a successful (or failed) run, check the `test/screenshots/` directory for visual confirmation of service health:
- `dashboard.png`
- `invidious.png`
- ... and all other services.

Comprehensive test results, including functional outcomes (like Invidious search verification and Cobalt connectivity), are recorded in `test/functional_test.log`.

### Manual Configuration

If you need to override values, you can manually edit `test_config.env` or use the template:
```bash
cp test_config.template.env test_config.env
```

### Key Components

- `test_runner.py`: The Python orchestrator for deployment and connectivity checks.
- `unified_test.js`: The Puppeteer script that performs deep UI verification and screenshot capture in a single pass.
- `package.json`: Contains dependencies for the Puppeteer/JS environment.