# Privacy Hub Configuration Reference

> **Complete transparency documentation for all configuration changes**
> 
> This document details every setting modified by the Privacy Hub, where it's changed, and why. Perfect for understanding exactly what the system does to your infrastructure.

## Quick Reference Table

| Service | Config File | Modified By | Key Changes |
|---------|-------------|-------------|-------------|
| AdGuard Home | `AdGuardHome.yaml` | `lib/services/config.sh` | Upstream DNS (Unbound), TLS, Sleepy Blocklist |
| Unbound | `unbound.conf` | `lib/services/config.sh` | DNSSEC, privacy hardening, caching |
| Gluetun | Environment vars | `lib/services/compose.sh` | **Quad9 Upstream**, VPN provider, firewall |
| WG-Easy | Environment vars | `lib/services/compose.sh` | Server endpoint, DNS, Split-tunneling |
| Nginx | `nginx.conf` | `lib/services/config.sh` | HTTPS, reverse proxy |
| Certificates | `ssl.crt/key` | `lib/services/config.sh` | Let's Encrypt automation |

---

## AdGuard Home Configuration

**Config File**: `${DATA_DIR}/adguard/conf/AdGuardHome.yaml`  
**Generated By**: `lib/services/config.sh` ‚Üí `setup_configs()`

### Upstream DNS ‚Üí Unbound
```yaml
dns:
  upstream_dns:
    - 172.x.0.250  # Local Unbound Container IP
  bootstrap_dns:
    - 172.x.0.250
```
**Why**: Routes all DNS queries through your local recursive Unbound resolver. This ensures no third-party DNS provider (like your ISP, Google, or Cloudflare) sees your DNS requests.

### Encrypted DNS Protocols
```yaml
tls:
  enabled: true
  server_name: ${DESEC_DOMAIN}
  port_dns_over_tls: 853
  port_dns_over_quic: 853
```
**Why**: Enables DNS-over-TLS (DoT) and DNS-over-QUIC (DoQ) so mobile devices can securely use your hub as their DNS server from outside your home network.

### Custom Blocklist: Sleepy Blocklist
```yaml
filters:
  - enabled: true
    url: https://raw.githubusercontent.com/Lyceris-chan/dns-blocklist-generator/main/blocklist.txt
    name: Sleepy Blocklist
    id: 1
```
**Why**: We use a curated, aggressive blocklist ("Sleepy Blocklist") designed to block ads, trackers, and telemetry effectively. This replaces default lists to ensure better coverage for privacy-conscious users.

---

## Unbound Configuration

**Config File**: `${DATA_DIR}/unbound/unbound.conf`  
**Generated By**: `lib/services/config.sh` ‚Üí `setup_configs()`

### DNSSEC Validation
```conf
auto-trust-anchor-file: "/var/unbound/root.key"
```
**Why**: Validates DNS responses cryptographically to prevent DNS spoofing and cache poisoning.

### Privacy Hardening (RFC 7816 & 8198)
```conf
qname-minimisation: yes          # RFC 7816
aggressive-nsec: yes             # RFC 8198
hide-identity: yes
hide-version: yes
minimal-responses: yes           # RFC 4472
```
**Why**: 
- **QNAME Minimisation**: Sends only the minimal necessary part of the domain name to upstream servers, reducing data leakage.
- **Hide Identity**: Prevents the server from broadcasting its version or identity to scanners.

---

## Gluetun VPN Configuration

**Configuration**: Docker Compose environment variables  
**Generated By**: `lib/services/compose.sh` ‚Üí `append_gluetun()`

### üõ°Ô∏è Upstream DNS: Quad9 (Privacy-First)
```yaml
environment:
  - DNS_UPSTREAM_RESOLVERS=quad9
  - DNS_KEEP_NAMESERVERS=off
  - DOT=off
```
**Why**: 
- **Default Avoidance**: Standard Gluetun configurations often default to Cloudflare (1.1.1.1). We explicitly override this to **Quad9 (9.9.9.9)**.
- **Privacy**: Quad9 is a Swiss-based non-profit that does not log IP addresses or sell browsing data. This ensures that even the DNS queries made *by the VPN tunnel itself* (to resolve VPN endpoints) are handled by a privacy-respecting provider, avoiding Google and Cloudflare completely.

### Firewall & Proxy
```yaml
environment:
  - FIREWALL_OUTBOUND_SUBNETS=${DOCKER_SUBNET}
  - HTTPPROXY=on
```
**Why**: 
- **Kill Switch**: The firewall ensures that if the VPN connection drops, traffic from connected containers (Invidious, Redlib, etc.) is blocked instantly, preventing IP leaks.
- **HTTP Proxy**: Used internally during setup to download assets (fonts, icons) anonymously through the VPN.

---

## WG-Easy Configuration (Remote Access)

**Configuration**: Docker Compose environment variables  
**Generated By**: `lib/services/compose.sh` ‚Üí `append_wg_easy()`

### Server Endpoint
```yaml
environment:
  - WG_HOST=${PUBLIC_IP}
  - WG_PORT=51820
```
**Why**: Defines the entry point for your remote devices (phones/laptops) to connect back to your home network.

### DNS Configuration
```yaml
environment:
  - WG_DEFAULT_DNS=${LAN_IP}
```
**Why**: Forces all connected WireGuard clients to use your Privacy Hub (AdGuard + Unbound) for DNS. This extends your ad-blocking and privacy protection to your mobile devices wherever you are in the world.

---

## Testing Suite Architecture

The Privacy Hub includes a comprehensive, multi-layer test suite to ensure stability and privacy compliance.

### 1. Integrity Audit
**File**: `test/verify_integrity.py`
- Checks file structure, permissions, and existence of critical configuration files.
- Ensures no required assets are missing.

### 2. Functional & API Suite
**File**: `test/test_runner.py`
- Python-based runner that validates the health of all 30+ services.
- Checks HTTP status codes and API responses.

### 3. Integration Tests
**File**: `test/test_integration.js`
- **Puppeteer** (headless browser) tests that simulate real user interactions.
- **Scenarios**:
    - **Invidious**: Video playback, search functionality.
    - **SearXNG**: Search query execution.
    - **Breezewiki/Redlib**: Page loading and content rendering.
- **Goal**: Verifies that frontends are not just "running" but actually functional and fetching content securely.

### 4. UI/UX Audit
**File**: `test/test_dashboard.js`
- Verifies the Dashboard's Material Design 3 layout.
- Checks responsiveness (grid scaling), theme toggling (light/dark), and admin authentication flows.

### 5. Specialized Operations
- **WireGuard**: `test/test_wireguard.js` verifies VPN client creation and configuration generation.
- **Ops**: `test/test_functional_ops.js` validates backend admin operations like updates, migrations, and rollbacks.

---

**Document Version**: 1.1.0  
**Last Updated**: 2026-01-17  
**Maintained By**: Privacy Hub Team